<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <!--
      manifest.json provides metadata used when your web app is added to the
      homescreen on Android. See https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">

      <!-- Setup base for everything -->
    <link rel="stylesheet" type="text/css" href="./css/global.css" />
    
    <!-- Our custom CSS -->
    <link rel="stylesheet" type="text/css" href="./css/monitor.css" />

    <!-- d3 -->
    <script type="text/javascript" src="./d3.v2.min.js"></script>
    
    <!-- Javascript to monitor and display -->
    <script src="./jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="./jquery.tinysort.min.js"></script>
    <script type="text/javascript" src="./tmpl.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    
    <!-- HystrixCommand -->
    <script type="text/javascript" src="./hystrixCommand.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/hystrixCommand.css" />
    
    <!-- HystrixThreadPool -->
    <script type="text/javascript" src="./hystrixThreadPool.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/hystrixThreadPool.css" />

    <script id="hystrixCircuit" type="text/x-jquery-tmpl">
      	<div class="counters">
          <div class="cell line">
            <a href="javascript://" title="Error Percentage [Timed-out + Threadpool Rejected + Failure / Total]" class="tooltip errorPercentage"><span class="value">{%= o.errorPercentage %}</span> %</a>
          </div>
          
          <div class="cell borderRight">
            <a href="javascript://" title="Timed-out Request Count" class="line tooltip timeout">{%= addCommas(rollingCountTimeout) %}</a>
            {% if(propertyValue_executionIsolationStrategy == 'THREAD') { %}
              <a href="javascript://" title="Threadpool Rejected Request Count" class="line tooltip rejected">{%= addCommas(rollingCountThreadPoolRejected) %}</a>
            {% } %}
            {% if(propertyValue_executionIsolationStrategy == 'SEMAPHORE') { %}
              <a href="javascript://" title="Semaphore Rejected Request Count" class="line tooltip rejected">{%= addCommas(rollingCountSemaphoreRejected) %}</a>
            {% } %}
            <a href="javascript://" title="Failure Request Count" class="line tooltip failure">{%= addCommas(rollingCountFailure) %}</a> 
          </div>
          <div class="cell borderRight">
            <a href="javascript://" title="Successful Request Count" class="line tooltip success">{%= addCommas(rollingCountSuccess) %}</a>
            <a href="javascript://" title="Short-circuited Request Count" class="line tooltip shortCircuited">{%= addCommas(rollingCountShortCircuited) %}</a>
            <a href="javascript://" title="Bad Request Count" class="line tooltip badRequest">{%= addCommas(rollingCountBadRequests) %}</a>
            <br>
          </div>
        </div>

        <div class="rate">
          <a href="javascript://" title="Total Request Rate per Second per Reporting Host" class="tooltip rate"><span class="smaller">Host: </span><span class="ratePerSecondPerHost">{%= addCommas(roundNumber(ratePerSecondPerHost)) %}</span>/s</a>
        </div>
        <div class="rate">	
          <a href="javascript://" title="Total Request Rate per Second for Cluster" class="tooltip rate"><span class="smaller">Cluster: </span><span class="ratePerSecond">{%= addCommas(roundNumber(ratePerSecond)) %}</span>/s</a>
        </div>
          
          <div class="circuitStatus">
          {% if(propertyValue_circuitBreakerForceClosed) { %}
            <span class="smaller">[ <font color="orange">Forced Closed</font> ]</span>
          {% } %}
          {% if(propertyValue_circuitBreakerForceOpen) { %}
            Circuit <font color="red">Forced Open</font>
          {% } else { %}
            {% if(isCircuitBreakerOpen == reportingHosts) { %}
              Circuit <font color="red">Open</font>
            {% } else if(isCircuitBreakerOpen == 0) { %}
              Circuit <font color="green">Closed</font>
            {% } else {
              /* We have some circuits that are open */  
            %}
              {% if(typeof isCircuitBreakerOpen === 'object' ) { %}
                Circuit <font color="red">Open {%= isCircuitBreakerOpen.true %}</font> <font color="green">Closed {%= isCircuitBreakerOpen.false %}</font>
              {% } else { %}
                Circuit <font color="orange">{%= isCircuitBreakerOpen.toString().replace("true", "Open").replace("false", "Closed") %}</font>
              {% } %}
            {% }  %}
          {% } %}
          </div>
          
          <div class="spacer"></div>
          
          <div class="tableRow">
            {% if(typeof reportingHosts != 'undefined') { %}
            <div class="cell header">Hosts</div>
            <div class="cell data">{%= reportingHosts %}</div>
            {% } else { %}
            <div class="cell header">Host</div>
            <div class="cell data">Single</div>
            {% } %}
            <div class="cell header">90th</div>
            <div class="cell data latency90"><span class="value">{%= getInstanceAverage(latencyExecute['90'], reportingHosts, false) %}</span>ms</div>
          </div>
          <div class="tableRow">
            <div class="cell header">Median</div>
            <div class="cell data latencyMedian"><span class="value">{%= getInstanceAverage(latencyExecute['50'], reportingHosts, false) %}</span>ms</div>
            <div class="cell header">99th</div>
            <div class="cell data latency99"><span class="value">{%= getInstanceAverage(latencyExecute['99'], reportingHosts, false) %}</span>ms</div>
          </div>
          <div class="tableRow">
            <div class="cell header">Mean</div>
            <div class="cell data latencyMean"><span class="value">{%= latencyExecute_mean %}</span>ms</div>
            <div class="cell header">99.5th</div>
            <div class="cell data latency995"><span class="value">{%= getInstanceAverage(latencyExecute['99.5'], reportingHosts, false) %}</span>ms</div>
          </div>
      <!-- 	<a href="">History</a> <a href="">EPIC</a> <a href="">Actions</a> -->
    </script>

    <script id="hystrixCircuitContainer" type="text/x-jquery-tmpl">
      <div class="monitor" id="CIRCUIT_{%= name + '_' + index %}" style="position:relative;">
        {%
          var displayName = name;
          var toolTip = "";
          if(displayName.length > 32) {
            displayName = displayName.substring(0,4) + "..." + displayName.substring(displayName.length-20, displayName.length);
            toolTip = "title=\"" + name + "\"";
          }
        %}
        
        <div id="chart_CIRCUIT_{%= name + '_' + index %}" class="chart" style="position:absolute;top:0px;left:0; float:left; width:100%; height:100%;"></div>
          <div style="position:absolute;top:0;width:100%;height:15px;opacity:0.8; background:white;">
            {% if(includeDetailIcon) { %}
            <p class="name" {%= toolTip %} style="padding-right:16px">
              {%= displayName %}
              <a href="../dependencies/command.jsp?name={%= name + '_' + index %}"><img src="../components/hystrixCommand/magnifying-glass-icon-20.png" height="14px" width="14px" border="0" style="position: absolute; right:0px;"></a>
            </p>
            {% }  else { %}
            <p class="name" {%= toolTip %}>{%= displayName %}</p>
            {% }  %}
          </div>
        <div style="position:absolute;top:15px;; opacity:0.8; background:white; width:100%; height:95%;">
          <div class="monitor_data"></div>
        </div>
        <div id="graph_CIRCUIT_{%= name + '_' + index %}" class="graph" style="position:absolute;top:25px;left:0; float:left; width:140px; height:62px;"></div>
      </div>
    </script>
    <script type="text/javascript" src="./monitor.js"></script>

    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Metrics Service</title>
</head>
<body>
<noscript>
    You need to enable JavaScript to run this app.
</noscript>
<div id="root"></div>
<!--
  This HTML file is a template.
  If you open it directly in the browser, you will see an empty page.

  You can add webfonts, meta tags, or analytics to this file.
  The build step will place the bundled scripts into the <body> tag.

  To begin the development, run `npm start` or `yarn start`.
  To create a production bundle, use `npm run build` or `yarn build`.
-->
</body>
</html>
